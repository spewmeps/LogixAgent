## Ftrace日志全局分析指标表

| **分析维度** | **关键指标** | **分析目的** | **异常特征** | **优先级** |
|------------|------------|------------|------------|----------|
| **CPU调度** | CPU利用率分布 | 识别CPU负载不均衡 | 某个CPU持续高负载(>90%)，其他CPU空闲 | 高 |
| | 上下文切换频率 | 发现过度调度问题 | 切换频率异常高(>10000次/秒) | 高 |
| | 进程/线程运行时间片 | 识别抢占和饥饿 | 时间片过短(<1ms)或某些进程长时间未调度 | 高 |
| | 调度延迟(latency) | 评估实时性能 | 延迟超过预期阈值(如>10ms) | 高 |
| **中断处理** | 硬中断频率和时长 | 发现中断风暴 | 中断频率异常高或单次中断耗时过长(>1ms) | 高 |
| | 软中断(softirq)耗时 | 识别网络/IO瓶颈 | NET_RX/TX, BLOCK等softirq占用时间过长 | 高 |
| | 中断分布不均 | CPU亲和性问题 | 中断集中在少数CPU上 | 中 |
| **进程/线程行为** | 运行态(Running)时长 | 识别CPU密集型任务 | 持续占用CPU不释放 | 高 |
| | 睡眠态(Sleep)时长 | 发现IO等待 | 长时间D状态(不可中断睡眠) | 高 |
| | 唤醒链路分析 | 追踪依赖关系 | 唤醒延迟过长或唤醒链路异常 | 中 |
| | 僵尸进程/异常退出 | 系统稳定性 | 进程异常终止或状态异常 | 中 |
| **锁竞争** | 锁等待时间 | 识别同步瓶颈 | 锁等待时间过长(>100ms) | 高 |
| | 锁持有者分析 | 定位热点锁 | 某些锁频繁被竞争 | 高 |
| | 死锁检测 | 系统hang问题 | 循环等待或长时间无法获取锁 | 高 |
| **内存操作** | 缺页中断频率 | 内存压力评估 | 主缺页(major fault)频率高 | 中 |
| | 内存分配延迟 | OOM风险 | 内存分配耗时异常或失败 | 高 |
| | 内存回收(reclaim)活动 | 内存不足 | 频繁触发内存回收或direct reclaim | 高 |
| **IO性能** | 块设备IO延迟 | 存储性能 | IO延迟超过正常范围(HDD>10ms, SSD>1ms) | 高 |
| | IO队列深度 | IO拥塞 | 队列长度持续很高 | 中 |
| | IO操作频率 | 识别IO热点 | 某些设备IO频率异常高 | 中 |
| **系统调用** | syscall耗时分布 | 发现慢系统调用 | 某些syscall耗时异常(如read/write >100ms) | 中 |
| | syscall失败率 | 资源不足 | EAGAIN, ENOMEM等错误频繁出现 | 中 |
| **时间线分析** | 时间戳连续性 | 发现时间跳变 | 时间戳出现倒退或大幅跳跃 | 低 |
| | 周期性模式 | 识别周期性问题 | 问题在特定时间间隔重复出现 | 中 |
| **功能调用链** | 函数调用深度 | 栈溢出风险 | 调用栈异常深 | 中 |
| | 热点函数耗时 | 性能瓶颈 | 某些函数耗时占比过高(>30%) | 高 |

## 建议的分析流程

1. **快速概览**（5分钟）
   - 查看trace时间范围和采样率
   - 统计总事件数和事件类型分布
   - 识别CPU数量和进程/线程总数

2. **CPU和调度分析**（重点）
   - 生成CPU利用率timeline
   - 统计上下文切换和调度延迟
   - 识别调度异常的时间窗口

3. **中断和软中断**（高优先级）
   - 统计各类中断的频率和耗时
   - 识别中断风暴时间段

4. **进程行为分析**
   - 找出TOP N耗时进程/线程
   - 分析D状态(不可中断睡眠)进程
   - 检查异常状态转换

5. **锁和同步**（如果启用）
   - 识别锁竞争热点
   - 分析锁等待时间分布

6. **定点分析准备**
   - 标记可疑时间段
   - 记录异常线程ID
   - 准备深入分析的过滤条件

你可以根据具体问题类型调整优先级。如果你有实际的ftrace日志，我可以帮你进行具体分析！
