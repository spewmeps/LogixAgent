# Linux 任务状态参考

关于 ftrace `sched_switch` 事件中可见的 Linux 任务状态的全面指南。

## 任务状态代码

### R - 正在运行或可运行 (Running or Runnable)
**全称**：TASK_RUNNING

**含义**：任务正处于以下状态之一：
1. 正在 CPU 上执行
2. 已准备好运行，正在运行队列中等待

**特征**：
- 任务需要 CPU 时间
- 不在等待任何外部事件
- 只要调度器选中它，就会立即运行

**分析意义**：
- R 状态时间长 → CPU 密集型负载
- 大量任务处于 R 状态 → CPU 资源竞争激烈
- R → R 的上下文切换表示 CPU 分时或抢占

**何时需要调查**：
- 与可用 CPU 核心数相比，处于 R 状态的任务过多
- 单个任务长时间独占 CPU（检查优先级）

---

### S - 可中断睡眠 (Interruptible Sleep)
**全称**：TASK_INTERRUPTIBLE

**含义**：任务正在睡眠等待某个事件，且可以被信号中断。

**常见原因**：
- 等待用户输入
- 等待网络数据
- 等待定时器到期
- 等待带超时的锁
- 在工作任务之间休眠

**特征**：
- 可以被信号（如 SIGTERM, SIGKILL 等）唤醒
- 主动放弃 CPU
- 空闲任务的正常预期状态

**分析意义**：
- 对大多数任务而言，这是大部分时间里的正常状态
- 频繁的 S → R 转换表示事件驱动型负载
- 长时间的 S 状态表示任务处于空闲或等待中

**何时需要调查**：
- 任务本应工作却处于 S 状态
- 异常的唤醒模式
- 异常短或异常长的睡眠周期

---

### D - 不可中断睡眠 (Uninterruptible Sleep)
**全称**：TASK_UNINTERRUPTIBLE

**含义**：任务正在睡眠，且**不能**被信号中断。

**常见原因**：
- 等待磁盘 I/O 完成
- 等待网络 I/O（有时）
- 等待设备驱动程序操作
- 持有关键的内核锁
- NFS 操作（典型原因）

**特征**：
- 无法被杀掉（即使是 SIGKILL）
- 通常很短暂（毫秒到秒级）
- 如果时间过长，通常表示 I/O 卡住或死锁

**⚠️ 关键性能指标**：
- D 状态时间长 = I/O 瓶颈
- 大量任务处于 D 状态 = 系统承受巨大的 I/O 压力
- 卡在 D 状态 = 严重问题（进程悬挂/死机）

**分析意义**：
```
D 状态计数 → I/O 操作频率
D 状态持续时间 → I/O 延迟
大量 D 状态任务 → I/O 子系统饱和
```

**何时需要调查**：
- 任何任务卡在 D 状态超过 120 秒（可能触发 hung_task_timeout）
- 频繁的 D 状态切换（检查存储性能）
- 多个虚拟机同时处于 D 状态（宿主机 I/O 瓶颈）

**常见元凶**：
- 慢速磁盘/SSD
- 网络文件系统 (NFS, CIFS)
- RAID 重建
- 硬件故障
- 内核死锁

---
